<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PIS • CALYCO</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --text:#111; --mut:#555; --line:#ddd; --head:#000; --note:#666;
    --blue:#274354; --green:#1f7a43; --purple:#5a3ea6; --teal:#126b6b; --orange:#b26a1e; --gold:#b08d2b;
    --chip:#f1f5f9; --chipText:#0f172a;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0; background:#fff; color:var(--text); font:14px/1.6 Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  .container{max-width:1000px; margin:0 auto; padding:28px 18px}
  header{margin-bottom:16px}
  h1{font-size:28px; margin:0 0 2px; color:var(--head); letter-spacing:.2px; text-align:center}
  .kicker{margin:0 0 18px; color:var(--mut); text-align:center}
  .btn-print{float:right; border:1px solid var(--line); background:#fafafa; padding:6px 10px; border-radius:6px; cursor:pointer}
  .section{margin:22px 0}
  .section h2{font-size:16px; margin:0 0 10px; color:#fff; text-align:center}
  p{margin:0 0 10px}
  ul{margin:6px 0 0 18px}
  /* table block with colored bar */
  .tbl{margin:0 0 18px; border:1px solid var(--line); border-radius:6px; overflow:hidden; background:#fff}
  .tbl-head{padding:10px 12px; color:#fff; font-weight:700; letter-spacing:.2px; text-transform:uppercase; text-align:center}
  .tbl.is-blue .tbl-head{background:var(--blue)}
  .tbl.is-green .tbl-head{background:var(--green)}
  .tbl.is-purple .tbl-head{background:var(--purple)}
  .tbl.is-teal .tbl-head{background:var(--teal)}
  .tbl.is-orange .tbl-head{background:var(--orange)}
  .tbl.is-gold .tbl-head{background:var(--gold)}
  table{width:100%; border-collapse:collapse; background:#fff}
  th,td{padding:10px 12px; border-top:1px solid var(--line); vertical-align:top}
  th{width:32%; text-align:left; background:#f7f7f7; font-weight:600}
  /* stacked cards */
  .card{border:1px solid var(--line); border-radius:6px; padding:12px; background:#fff; margin:0 0 18px}
  .card .head{padding:10px 12px; margin:-12px -12px 10px; color:#fff; font-weight:700; text-align:center; text-transform:uppercase; letter-spacing:.2px; background:var(--teal); border-bottom:1px solid rgba(0,0,0,.06); border-top-left-radius:6px; border-top-right-radius:6px}
  .note{color:var(--note); font-size:12px; margin-top:6px; text-align:center}
  /* badges/chips */
  .badges{display:flex; flex-wrap:wrap; gap:8px; margin:8px 0}
  .badge{background:var(--chip); color:var(--chipText); border:1px solid var(--line); padding:4px 8px; border-radius:999px; font-size:12px}
  .group-title{font-weight:600; color:var(--mut); margin-top:6px}
  .toolchips .badge{background:#eef6ff; border-color:#cfe0ff}
  @media print{ .btn-print{display:none} a[href]:after{content:""} body{color:#000} }
</style>
</head>
<body>
<main class="container">
  <button class="btn-print" onclick="window.print()">Print</button>
  <header>
    <h1 id="title">Product Information Sheet</h1>
    <div class="kicker" id="subtitle">CALYCO</div>
  </header>

  <div id="content">Loading…</div>
</main>

<script>
// ---------- helpers ----------
const esc = x => x==null?"":String(x).replace(/[&<>\"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]));
const li = a => (a||[]).map(x=>`<li>${esc(x)}</li>`).join("");
const labelize = k => String(k||"").replace(/_/g," ").replace(/\b\w/g,m=>m.toUpperCase());
const kvRows = o => Object.entries(o||{}).map(([k,v])=>`<tr><th>${esc(labelize(k))}</th><td>${esc(v)}</td></tr>`).join("");
const maybe = (cond, html) => cond ? html : "";

// ---------- render ----------
function render(d){
  // header text
  if(d.sheet_title) document.getElementById("title").textContent = d.sheet_title;
  document.getElementById("subtitle").textContent = d.pis_title || "CALYCO";

  return `
  ${maybe(d.titles && (d.titles.title || d.titles.title2 || d.titles.premium), `
    <section class="section">
      <div class="card">
        <div class="head" style="background:var(--blue)">Title Block</div>
        <p><strong>${esc(d.titles.title || "")}</strong>${d.titles.premium?` • ${esc(d.titles.premium)}`:""}${d.titles.title2?` — ${esc(d.titles.title2)}`:""}</p>
      </div>
    </section>
  `)}

  ${maybe(d.product_overview, `
    <section class="section">
      <div class="card">
        <div class="head" style="background:var(--blue)">Product Description</div>
        <p>${esc(d.product_overview)}</p>
        ${maybe(d.short_description, `<p><em>${esc(d.short_description)}</em></p>`)}
        ${maybe(d.positioning, `<p>${esc(d.positioning)}</p>`)}
        
      </div>
    </section>
  `)}

  ${maybe(d.icons && (d.icons.main?.length || d.icons.minor?.length || d.icons.extra?.length), `
    <section class="section">
      <div class="card">
        <div class="head" style="background:var(--green)">Icons</div>
        ${maybe(d.icons.main?.length, `<div class="group-title">Main</div><div class="badges">${d.icons.main.map(x=>`<span class="badge">${esc(x)}</span>`).join("")}</div>`)}
        ${maybe(d.icons.minor?.length, `<div class="group-title">Minor</div><div class="badges">${d.icons.minor.map(x=>`<span class="badge">${esc(x)}</span>`).join("")}</div>`)}
        ${maybe(d.icons.extra?.length, `<div class="group-title">Extra</div><div class="badges">${d.icons.extra.map(x=>`<span class="badge">${esc(x)}</span>`).join("")}</div>`)}
      </div>
    </section>
  `)}

  ${maybe(d.key_features?.length, `
    <section class="section">
      <div class="card">
        <div class="head" style="background:var(--green)">Key Features</div>
        <ul>${li(d.key_features)}</ul>
      </div>
    </section>
  `)}

  ${maybe(d.features_benefits?.length, `
    <section class="section">
      <div class="tbl is-orange">
        <div class="tbl-head">Key Features & Benefits</div>
        <table>
          <tr><th>Feature</th><td><strong>Benefit & Description</strong></td></tr>
          ${d.features_benefits.map(x=>`
            <tr><th>${esc(x.feature||"")}</th><td>${esc(x.benefit||"")}</td></tr>
          `).join("")}
        </table>
      </div>
    </section>
  `)}

  ${maybe(d.coverage || d.finish || d.thinner || (d.timings && Object.keys(d.timings).length) || d.available_sizes, `
    <section class="section">
      <div class="tbl is-gold">
        <div class="tbl-head">Quick Specs</div>
        <table>
          ${maybe(d.coverage, `<tr><th>Coverage</th><td>${esc(d.coverage)}</td></tr>`)}
          ${maybe(d.finish, `<tr><th>Finish</th><td>${esc(d.finish)}</td></tr>`)}
          ${maybe(d.thinner, `<tr><th>Thinner</th><td>${esc(d.thinner)}</td></tr>`)}
          ${maybe(d.timings && Object.keys(d.timings).length, `
            <tr><th>Timings</th><td>${Object.entries(d.timings).map(([k,v])=>`${esc(labelize(k))}: ${esc(v)}`).join(" · ")}</td></tr>
          `)}
        </table>
      </div>
      ${maybe(d.available_sizes, `<div class="note">Available Sizes: ${esc(d.available_sizes)}</div>`)}
    </section>
  `)}

  ${maybe(d.application_tools?.length, `
    <section class="section">
      <div class="card">
        <div class="head" style="background:var(--teal)">Application Tools</div>
        <div class="badges toolchips">${d.application_tools.map(x=>`<span class="badge">${esc(x)}</span>`).join("")}</div>
      </div>
    </section>
  `)}

  ${maybe(d.technical_data && Object.keys(d.technical_data).length, `
    <section class="section">
      <div class="tbl is-blue">
        <div class="tbl-head">Technical Data</div>
        <table>${kvRows(d.technical_data)}</table>
      </div>
    </section>
  `)}

  ${maybe(d.recommended_use?.items?.length, `
    <section class="section">
      <div class="card">
        <div class="head" style="background:var(--purple)">Recommended Use</div>
        ${maybe(d.recommended_use.intro, `<p>${esc(d.recommended_use.intro)}</p>`)}
        <ul>${li(d.recommended_use.items)}</ul>
      </div>
    </section>
  `)}

  ${maybe(d.recommended_substrates?.length, `
    <section class="section">
      <div class="tbl is-teal">
        <div class="tbl-head">Recommended Substrates</div>
        <table>
          ${d.recommended_substrates.map(s=>`
            <tr><th>${esc(s.type||"")}</th><td>${esc(s.description||"")}</td></tr>
          `).join("")}
        </table>
      </div>
    </section>
  `)}

  ${maybe(d.application_system?.length, `
    <section class="section">
      <div class="tbl is-teal">
        <div class="tbl-head">Application System</div>
        <table>
          ${d.application_system.map(s=>`
            <tr>
              <th>${esc(s.step)}. ${esc(s.label||"")}</th>
              <td>
                ${maybe(s.product, `<div><strong>Product:</strong> ${esc(s.product)}</div>`)}
                ${maybe(s.purpose, `<div>${esc(s.purpose)}</div>`)}
              </td>
            </tr>
          `).join("")}
        </table>
      </div>
    </section>
  `)}

  ${maybe(d.surface_preparation?.length, `
    <section class="section">
      <div class="card">
        <div class="head" style="background:var(--orange)">Surface Preparation</div>
        <ul>${li(d.surface_preparation)}</ul>
      </div>
    </section>
  `)}

  ${maybe(d.application?.length, `
    <section class="section">
      <div class="card">
        <div class="head" style="background:var(--green)">Application Notes</div>
        <ul>${li(d.application)}</ul>
      </div>
    </section>
  `)}

  ${maybe(d.limitations && Object.keys(d.limitations).length, `
    <section class="section">
      <div class="tbl is-orange">
        <div class="tbl-head">Limitations & Conditions</div>
        <table>${kvRows(d.limitations)}</table>
      </div>
    </section>
  `)}

  ${maybe(d.storage_safety?.length, `
    <section class="section">
      <div class="card">
        <div class="head" style="background:var(--blue)">Storage & Safety</div>
        <ul>${li(d.storage_safety)}</ul>
      </div>
    </section>
  `)}

  ${maybe(d.safety_first_aid && Object.keys(d.safety_first_aid).length, `
    <section class="section">
      <div class="tbl is-blue">
        <div class="tbl-head">Safety • First Aid</div>
        <table>${kvRows(d.safety_first_aid)}</table>
      </div>
    </section>
  `)}

  ${maybe(d.environmental_commitment, `
    <section class="section">
      <div class="card">
        <div class="head" style="background:var(--green)">Environmental Commitment</div>
        <p>${esc(d.environmental_commitment)}</p>
      </div>
    </section>
  `)}

  ${maybe(d.specs_summary && Object.keys(d.specs_summary).length, `
    <section class="section">
      <div class="tbl is-gold">
        <div class="tbl-head">Specs Summary</div>
        <table>${kvRows(d.specs_summary)}</table>
      </div>
    </section>
  `)}

  ${maybe(d.usage && (d.usage.application || d.usage.advantages?.length || d.usage.substrate?.length || d.usage.recommended_uses?.length), `
    <section class="section">
      <div class="card">
        <div class="head" style="background:var(--purple)">Usage</div>
        ${maybe(d.usage.application, `<p><strong>Application:</strong> ${esc(d.usage.application)}</p>`)}
        ${maybe(d.usage.advantages?.length, `<div class="group-title">Advantages</div><ul>${li(d.usage.advantages)}</ul>`)}
        ${maybe(d.usage.substrate?.length, `<div class="group-title">Compatible Substrates</div><ul>${li(d.usage.substrate)}</ul>`)}
        ${maybe(d.usage.recommended_uses?.length, `<div class="group-title">Recommended Uses</div><ul>${li(d.usage.recommended_uses)}</ul>`)}
      </div>
    </section>
  `)}

  ${maybe(d.commerce && (d.commerce.name || d.commerce.category || d.commerce.packaging || d.commerce.product_number || d.commerce.price_inr || d.commerce.brand), `
    <section class="section">
      <div class="tbl is-purple">
        <div class="tbl-head">Commerce</div>
        <table>
          ${maybe(d.commerce.name, `<tr><th>Name</th><td>${esc(d.commerce.name)}</td></tr>`)}
          ${maybe(d.commerce.category, `<tr><th>Category</th><td>${esc(d.commerce.category)}</td></tr>`)}
          ${maybe(d.commerce.brand, `<tr><th>Brand</th><td>${esc(d.commerce.brand)}</td></tr>`)}
          ${maybe(d.commerce.packaging, `<tr><th>Packaging</th><td>${esc(d.commerce.packaging)}</td></tr>`)}
          ${maybe(d.commerce.product_number, `<tr><th>Product Number</th><td>${esc(d.commerce.product_number)}</td></tr>`)}
          ${maybe(d.commerce.price_inr!=null, `<tr><th>Price (INR)</th><td>${esc(d.commerce.price_inr)}</td></tr>`)}
        </table>
      </div>
    </section>
  `)}

  ${maybe(d.contact_info || d.doc_notes, `
    <section class="section">
      <div class="card">
        <div class="head" style="background:var(--blue)">Contact & Notes</div>
        ${maybe(d.contact_info, `<p><strong>Contact:</strong> ${esc(d.contact_info)}</p>`)}
        ${maybe(d.doc_notes, `<p class="note">${esc(d.doc_notes)}</p>`)}
      </div>
    </section>
  `)}
  `;
}

// ---------- boot ----------
(async function(){
  const params = new URLSearchParams(location.search);
  const src = params.get("src");
  const $content = document.getElementById("content");

  if(!src){
    $content.innerHTML = `<div>Missing JSON data source. Use ?src=file.json</div>`;
    return;
  }
  try{
    const r = await fetch(src);
    if(!r.ok) throw new Error(`HTTP ${r.status}`);
    const data = await r.json();
    $content.innerHTML = render(data);
    if(data.sheet_title) document.title = `PIS • ${data.sheet_title}`;
  }catch(e){
    $content.innerHTML = `<div>Failed to load product data. ${esc(e.message||"")}</div>`;
  }
})();
</script>
</body>
</html>
